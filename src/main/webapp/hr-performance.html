<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>HR Performance | EMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<link href="assets/css/main.css" rel="stylesheet">

<style>

body{
    background:#f4f7fb;
}

.card-box{
    background:#fff;
    padding:25px;
    border-radius:12px;
    box-shadow:0 2px 10px rgba(0,0,0,0.08);
}

</style>

</head>


<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
<div class="container">

<a class="navbar-brand fw-bold">EMS HR</a>

<ul class="navbar-nav ms-auto">

<li class="nav-item">
<a class="nav-link" href="hr_dashboard.html">Dashboard</a>
</li>

<li class="nav-item">
<a class="nav-link active" href="#">Performance</a>
</li>

<li class="nav-item">
<a class="nav-link" href="hr-payroll.html">Payroll</a>
</li>

<li class="nav-item">
<a class="nav-link text-warning" href="index.html">Logout</a>
</li>

</ul>

</div>
</nav>



<div class="container mt-5">

<h4 class="mb-4">Employee Performance Evaluation</h4>


<div class="row">

<div class="col-md-6 mx-auto">

<div class="card-box">


<!-- Employee -->
<label class="mb-1">Select Employee</label>
<select id="emp" class="form-select mb-3"></select>


<!-- Score -->
<label class="mb-1">Performance Score (0–100)</label>
<input id="score" type="number"
class="form-control mb-3"
placeholder="Enter score">


<!-- Grade -->
<label class="mb-1">Grade</label>
<select id="grade" class="form-select mb-4">

<option>A+</option>
<option>A</option>
<option>B</option>
<option>C</option>
<option>D</option>

</select>


<!-- Save -->
<button onclick="save()"
class="btn btn-primary w-100">

Save Performance

</button>


</div>

</div>

</div>

</div>



<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<script>

document.addEventListener("DOMContentLoaded", () => {
    loadEmployees();
});


// ================= LOAD EMPLOYEES =================

function loadEmployees(){

    fetch("HRPayrollServlet?action=getEmployees")

    .then(r => r.json())

    .then(data => {

        let s = document.getElementById("emp");

        s.innerHTML = "";

        data.forEach(e => {

            s.innerHTML +=
            `<option value="${e.id}">${e.name}</option>`;

        });

    })

    .catch(err => {
        console.error("Load employees error:", err);
    });

}



// ================= SAVE =================

function save(){

    // ✅ FIX: Get elements properly
    let emp   = document.getElementById("emp").value;
    let score = document.getElementById("score").value;
    let grade = document.getElementById("grade").value;


    // ✅ Validation
    if(score === "" || score < 0 || score > 100){

        alert("Enter valid score (0–100)");
        return;

    }


    let body =
    `userId=${emp}&score=${score}&grade=${grade}`;


    fetch("PerformanceServlet", {

        method: "POST",

        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },

        body: body

    })

    .then(r => r.json())

    .then(d => {

        alert(d.message);

        // Optional: Reset after save
        document.getElementById("score").value = "";
        document.getElementById("grade").selectedIndex = 0;

    })

    .catch(err => {
        console.error("Save error:", err);
        alert("Server error. Try again.");
    });

}

</script>



</body>
</html>
